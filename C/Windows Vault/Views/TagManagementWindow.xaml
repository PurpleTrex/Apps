<Window x:Class="WindowsVault.Views.TagManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="Tag Management" 
        Height="700" 
        Width="900"
        MinHeight="600"
        MinWidth="800"
        WindowStartupLocation="CenterOwner"
        Icon="/vault-icon.ico">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Tag Management" FontSize="24" FontWeight="SemiBold"/>
            <TextBlock Text="Create, edit, and organize your custom tags" 
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Tags List -->
            <Grid Grid.Column="0" Margin="0,0,16,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Tags Section -->
                <TextBlock Grid.Row="0" Text="Your Tags" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                
                <Border Grid.Row="1" Style="{StaticResource MediaItemCardStyle}">
                    <ListView ItemsSource="{Binding Tags}" 
                              SelectedItem="{Binding SelectedTag}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Name" Width="150">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Rectangle Width="16" Height="16" 
                                                         Fill="{Binding Color}"
                                                         Margin="0,0,8,0" 
                                                         RadiusX="3" RadiusY="3"/>
                                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Usage Count" Width="100" DisplayMemberBinding="{Binding UsageCount}"/>
                                <GridViewColumn Header="Created" Width="120" DisplayMemberBinding="{Binding DateCreated, StringFormat={}{0:MM/dd/yyyy}}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </Grid>

            <!-- Tag Editor Panel -->
            <Border Grid.Column="1" Style="{StaticResource MediaItemCardStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Tag Editor" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,16"/>

                        <!-- Create New Tag Section (Always Visible) -->
                        <StackPanel Visibility="{Binding SelectedTag, Converter={StaticResource InverseNullToVisibilityConverter}, FallbackValue=Visible}">
                            <TextBlock Text="Create New Tag" FontSize="14" FontWeight="Medium" Margin="0,0,0,8"/>

                            <TextBlock Text="Tag Name:" Margin="0,0,0,4"/>
                            <TextBox Text="{Binding NewTagName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,8"/>

                            <TextBlock Text="Color:" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBox Text="{Binding NewTagColor, UpdateSourceTrigger=PropertyChanged}"
                                         Width="80"
                                         Margin="0,0,8,0"
                                         Name="NewTagColorTextBox"/>
                                <Border Width="24"
                                        Height="24"
                                        Background="{Binding NewTagColor}"
                                        CornerRadius="3"
                                        BorderBrush="Gray"
                                        BorderThickness="1"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="NewTagColorPicker_Click"
                                        ToolTip="Click to pick a color"/>
                            </StackPanel>

                            <Button Content="Create Tag"
                                    Command="{Binding CreateTagCommand}"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Margin="0,0,0,16"/>

                            <!-- Instruction when no tag selected -->
                            <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                    CornerRadius="4"
                                    Padding="12">
                                <TextBlock Text="Select a tag from the list to edit or delete it"
                                           TextAlignment="Center"
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                           FontStyle="Italic"/>
                            </Border>
                        </StackPanel>

                        <!-- Edit Selected Tag Section (Only visible when tag selected) -->
                        <StackPanel Visibility="{Binding SelectedTag, Converter={StaticResource NullToVisibilityConverter}}">
                            <TextBlock Text="Edit Selected Tag" FontSize="14" FontWeight="Medium" Margin="0,0,0,8"/>

                            <TextBlock Text="Tag Name:" Margin="0,0,0,4"/>
                            <TextBox Text="{Binding SelectedTagName, UpdateSourceTrigger=PropertyChanged}"
                                     Name="SelectedTagNameBox"
                                     Margin="0,0,0,8"/>

                            <TextBlock Text="Color:" Margin="0,0,0,4"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBox Text="{Binding SelectedTagColor, UpdateSourceTrigger=PropertyChanged}"
                                         Width="80"
                                         Margin="0,0,8,0"
                                         Name="SelectedTagColorBox"/>
                                <Border Width="24"
                                        Height="24"
                                        Background="{Binding SelectedTagColor}"
                                        CornerRadius="3"
                                        BorderBrush="Gray"
                                        BorderThickness="1"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="SelectedTagColorPicker_Click"
                                        ToolTip="Click to pick a color"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Button Content="Update"
                                        Command="{Binding UpdateTagCommand}"
                                        Name="UpdateTagButton"
                                        Margin="0,0,8,0"/>
                                <Button Content="Delete"
                                        Command="{Binding DeleteTagCommand}"
                                        Name="DeleteTagButton"
                                        Style="{StaticResource DangerButtonStyle}"
                                        Margin="0,0,8,0"/>
                                <Button Content="Deselect"
                                        Command="{Binding DeselectTagCommand}"
                                        ToolTip="Deselect tag to create a new one"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                CornerRadius="4" 
                Padding="12,8"
                Margin="0,16,0,0"
                Visibility="{Binding StatusMessage, Converter={StaticResource StringToVisibilityConverter}}">
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Opacity="0.8"
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:ProgressRing IsActive="{Binding IsLoading}" Width="48" Height="48" Margin="0,0,0,16"/>
                <TextBlock Text="Loading tags..." HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>