<UserControl x:Class="WindowsVault.Views.MediaItemControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="MediaItemRoot"
             MouseLeftButtonDown="MediaItem_Click">
    
    <Border x:Name="ItemBorder"
            Width="{Binding ThumbnailSize, ElementName=MediaItemRoot}"
            Height="{Binding ThumbnailSize, ElementName=MediaItemRoot}">
        <Border.Style>
            <Style TargetType="Border" BasedOn="{StaticResource MediaItemCardStyle}">
                <Setter Property="BorderThickness" Value="2"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                        <Setter Property="BorderBrush" Value="{DynamicResource SystemControlHighlightAccentBrush}"/>
                        <Setter Property="BorderThickness" Value="4"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Style>
        
        <Border.ContextMenu>
            <ContextMenu>
                <MenuItem Header="📂 Open File" Click="OpenFile_Click"/>
                <MenuItem Header="🏷️ Manage Tags" Click="ManageTags_Click"/>
                <Separator/>
                <MenuItem Header="⭐ Toggle Favorite" Click="ToggleFavorite_Click"/>
                <Separator/>
                <MenuItem Header="🗑️ Delete" Click="Delete_Click"/>
            </ContextMenu>
        </Border.ContextMenu>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Thumbnail -->
            <Border Grid.Row="0" Background="Black" CornerRadius="4" Margin="0,0,0,8">
                <Grid>
                    <!-- Image/Video Thumbnail -->
                    <Image x:Name="ThumbnailImage"
                           Source="{Binding ThumbnailPath}"
                           Stretch="UniformToFill"
                           StretchDirection="Both"/>
                    
                    <!-- Media Type Indicator -->
                    <Border HorizontalAlignment="Right"
                           VerticalAlignment="Top"
                           Background="#80000000"
                           CornerRadius="4"
                           Padding="6,2"
                           Margin="4">
                        <TextBlock Foreground="White" FontSize="10">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0}">
                                    <Binding Path="MediaType"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </Border>
                    
                    <!-- Favorite Indicator -->
                    <Border HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           Background="#80000000"
                           CornerRadius="4"
                           Padding="4,2"
                           Margin="4"
                           Visibility="{Binding IsFavorite, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="⭐" Foreground="#FFD700" FontSize="12"/>
                    </Border>
                    
                    <!-- Duration for videos -->
                    <Border HorizontalAlignment="Right"
                           VerticalAlignment="Bottom"
                           Background="#80000000"
                           CornerRadius="4"
                           Padding="6,2"
                           Margin="4"
                           Visibility="{Binding Duration, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Foreground="White" FontSize="10">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="mm\\:ss">
                                    <Binding Path="Duration"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </Border>
                </Grid>
            </Border>
            
            <!-- File Name -->
            <TextBlock Grid.Row="1" 
                      Text="{Binding FileName}" 
                      FontSize="12"
                      FontWeight="Medium"
                      Margin="0,0,0,4"
                      TextTrimming="CharacterEllipsis"
                      ToolTip="{Binding FileName}"/>
            
            <!-- Tags and Info -->
            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Tags -->
                <ItemsControl Grid.Row="0" ItemsSource="{Binding Tags}" Margin="0,0,0,4">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource TagChipStyle}" Background="{Binding Color}">
                                <TextBlock Text="{Binding Name}" 
                                          Foreground="White" 
                                          FontSize="9"
                                          FontWeight="Medium"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- File Info -->
                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <TextBlock Text="{Binding FileSizeFormatted}" 
                              FontSize="10"
                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              Margin="0,0,8,0"/>
                    
                    <TextBlock FontSize="10"
                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:MM/dd/yyyy}">
                                <Binding Path="DateAdded"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
    
</UserControl>